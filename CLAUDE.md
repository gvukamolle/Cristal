# CLAUDE.md

Этот файл содержит инструкции для Claude Code (claude.ai/code) при работе с кодом в этом репозитории.

## Язык общения

Всё общение с пользователем ведётся на **русском языке**. Комментарии в коде, названия коммитов и техническая документация могут быть на английском.

## Команды сборки

```bash
npm install              # Установка зависимостей
npm run dev              # Запуск компиляции в режиме наблюдения (watch mode)
npm run build            # Продакшн сборка (проверка типов + бандлинг)
npm run install-plugin   # Установка плагина в vault (автоматическая символическая ссылка)
npm run lint             # Запуск ESLint для проверки кода
```

### Порядок работы

1. После клонирования репозитория выполнить `npm install`
2. Установить плагин в vault: `npm run install-plugin [путь-к-vault]` (по умолчанию: `/Users/timofeygrushko/Documents/Big Base`)
3. Для разработки использовать `npm run dev` — изменения компилируются автоматически
4. Перезагрузить Obsidian (Cmd+R) для применения изменений
5. Перед релизом выполнить `npm run build` для полной проверки

## Архитектура

Это плагин для Obsidian, написанный на TypeScript и собираемый с помощью esbuild.

### Структура файлов

- **Точка входа**: `src/main.ts` — жизненный цикл плагина (onload/onunload), регистрация команд
- **Настройки**: `src/settings.ts` — интерфейс настроек, значения по умолчанию, UI вкладки настроек
- **Результат сборки**: компилируется в `main.js` в корне проекта для загрузки Obsidian

### Ключевые классы

- `MyPlugin` (в main.ts) — главный класс плагина, наследуется от `Plugin`
- `SampleModal` (в main.ts) — пример модального окна
- `SampleSettingTab` (в settings.ts) — вкладка настроек плагина

## Ключевые паттерны

- Использовать хелперы `this.register*` для DOM-событий, интервалов и слушателей — это гарантирует очистку при выгрузке плагина
- Сохранять настройки через `this.loadData()` / `this.saveData()`
- ID команд должны быть стабильными — никогда не переименовывать после релиза
- Держать `main.ts` минимальным; выносить логику фич в отдельные модули
- Регистрировать события через `this.registerEvent()`, `this.registerDomEvent()`, `this.registerInterval()`

### ВАЖНО: ID плагина

**ID плагина должен быть единым** и определяется в `manifest.json` (поле `id`). Этот ID используется:
- Obsidian для идентификации плагина
- Скриптом установки для создания папки `.obsidian/plugins/<plugin-id>/`

⚠️ Поле `name` в `package.json` может отличаться от `id` в `manifest.json`, но для избежания путаницы рекомендуется держать их синхронизированными.

## Тестирование

Только ручное тестирование.

### Автоматическая установка (рекомендуется)

Использовать скрипт `install.mjs`, который автоматически создаст символическую ссылку с правильным ID из `manifest.json`:

```bash
npm run install-plugin [путь-к-vault]
```

Скрипт:
- Читает ID плагина из `manifest.json` (защита от ошибок с неправильным именем папки)
- Удаляет старые символические ссылки, если они есть
- Создает новую ссылку в `.obsidian/plugins/<plugin-id>/`

### Ручная установка

Альтернативно, можно скопировать `main.js`, `manifest.json` и `styles.css` (если есть) в:
```
<Vault>/.obsidian/plugins/<plugin-id>/
```

### Активация плагина

1. Перезагрузить Obsidian (Ctrl+R или Cmd+R)
2. Открыть **Настройки → Сторонние плагины**
3. Включить плагин

## Артефакты релиза

**Обязательные файлы**: `main.js`, `manifest.json`
**Опциональные**: `styles.css`

Перед релизом:
1. Обновить версию в `manifest.json` (SemVer: x.y.z)
2. Обновить маппинг в `versions.json` (версия плагина → минимальная версия Obsidian)
3. Создать GitHub Release с тегом, совпадающим с версией (без префикса `v`)

## Полезные ссылки

- Документация Obsidian API: https://docs.obsidian.md
- Гайдлайны для плагинов: https://docs.obsidian.md/Plugins/Releasing/Plugin+guidelines
